<!DOCTYPE html>
<html>
	<head>
		<title>Brian First Test</title>
		<script src="js/jQuery_v2_1_3.js"></script>
		<script src="js/jquery.easing.1.3.js"></script>
		<script src="js/OSC.js"></script>
		<style>
			
			.redBox { 	  position:absolute; 
					 	  width:50px;
						  height:50px;
						  background:red;
			}
			
			.greenBox {	  position:absolute; 
					 	  width:50px;
						  height:50px;
						  background:green;
			}
			
			.blueBox {	  position:absolute; 
					 	  width:50px;
						  height:50px;
						  background:blue;
			}
			
			.pinkBox {	  position:absolute; 
					 	  width:10px;
						  height:10px;
						  background:pink;
			}
			
			#container{	  position:absolute;
						  width:600px;
						  height:600px;
						  left:0px;
						  top:00px;
						  border:1px solid red;
						  transform-origin: 50% 50%;
						   -webkit-transform-origin: 300px 300px; /* Chrome, Safari, Opera */
						  
			}
			
			#character{	  position:absolute;
						  width:50px;
						  height:50px;
						  background:orange;
						  left:300px;
						  top:300px;
			
			}
			
			
			
		
		</style>
	</head>
	
	<body>
		<div id='container'></div>
		<div id='character'></div>
		<div id='debug'></div>
		<script>
		
			var row 	= 	0;
			var column 	= 	0;
			var colMax	= 	5;
			var rowMax	=	5;
			var classes = ['redBox', 'greenBox', 'blueBox'];
			var angle = 0;
			var containerRotation = 0;
			var direction = 'horizontal';
			var xorigin = 50;
			var yorigin = 50;
			var divMDArray = Array(
					Array(),
					Array(),
					Array(),
					Array(),
					Array());
					
			$('#container').click(addSprite);
			
			$(document).keypress(alertKey);
			
			addOrigin();
			$('#debug').html('a');
			
			function addOrigin(){
				var newDiv = document.createElement('div');
				var id = "origin";
				newDiv.id = id;
				newDiv.className = "pinkBox";
				O('container').appendChild(newDiv); 
				$('#'+id).css('left',300);
				$('#'+id).css('top',300);
			}
			
			function moveOrigin(x,y){
				$('#origin').css('left',x);
				$('#origin').css('top',y);
			}
			
			function addSprite(){
				
				if(row<rowMax){
					if(column < colMax){
						//createNewSprite
						divMDArray[row].push(createSprite(row,column));
						column++;
					}else{
						row++;
						column = 0;
						addSprite();
					}
				}else{
				}
			}
			
			function createSprite(row,col){
				var newDiv = document.createElement('div');
				var id = 'sprite'+"_"+row+"_"+col;
				newDiv.id = id;
				classes.unshift(classes.pop());
				var _className = classes[0];
				newDiv.className = _className;
				O('container').appendChild(newDiv); 
				$('#'+id).css('left',col * 50);
				$('#'+id).css('top',row * 50);
				
				$('#'+id).click(showName);
				
				return {_name:id, _class:_className};
				
				
			}
			
			function showName(){
				
		        var id = $(this).attr("id");
		
			}
			
			function alertKey(event){
				key = (event.which)
				if(String.fromCharCode(key) == "x"){
					/*$('#container').finish();
					var position = $('#container').position();	
					setTransformOrigin(position);
					$('#container').animate( {left:(position.left+'px'), top:(position.top + 50+'px') }, 100, 'swing');
					*/
					$('#container').finish();
					var position = $('#container').position();	
					setTransformOrigin(position);
					rotateSpriteSheet(angle -= 180);
				}
				if(String.fromCharCode(key) == "w"){
					$('#container').finish();
					var position = $('#container').position();
					//setTransformOrigin(position);
					$('#container').animate( {left:"+=0", top:"+=50" }, 100, 'swing');
				}
				if(String.fromCharCode(key) == "a"){
					$('#container').finish();
					var position = $('#container').position();	
					setTransformOrigin(position);
					rotateSpriteSheet(angle -= 90);
				}
				if(String.fromCharCode(key) == "d"){
					$('#container').finish();
					var position = $('#container').position();	
					setTransformOrigin(position);
					rotateSpriteSheet(angle += 90);
				}
			}
			
			function rotateSpriteSheet(degrees){
				var remainder = (degrees/360)%1;
				//$('#debug').html((degrees/360)%1);
				if(remainder < 0){
					var percent = 1 + remainder;	
				}else{
					var percent = remainder;
				}
				containerRotation = 360 * percent;
				//$('#debug').html(containerRotation);
				
				$('#container').animate(
										{target: degrees}, 
											{step: function(now,fx) {
														$(this).css('-webkit-transform','rotate('+now+'deg)'); 
														$(this).css('-moz-transform','rotate('+now+'deg)');
														$(this).css('transform','rotate('+now+'deg)');
												   }
													,duration:500,
													easing:'easeOutCirc',
													complete:rotateSprite
											});
				
			}
			
			function setTransformOrigin(position){
				var startPosition = position;
				var point = {x:0, y:0};
				switch(containerRotation){
					case 0:
						//point.x = position.left;
						//point.y = position.top;
						//var xpos = 300 - point.x;
						//var ypos = 350 - point.y;
						//moveOrigin(xpos,ypos);
						//$('#container').css('-webkit-transform-origin',xpos+"px" + " " + ypos+"px"); 
						break;
					case 90:
						/*var x = 300 - position.left;
						var y = 350 - position.top;
						point.x = y;
						point.y = x;
						$('#debug').html(point.x);*/
						point.x = position.left;
						point.y = position.top;
						$('#debug').html(point.x);
						break;
					case 180:
						/*
						var x = 300 - position.left;
						var y = 350 - position.top;
						point.x = x;
						point.y = y;
						$('#debug').html(point.x);
						*/
						point.y = position.left;
						point.x = position.top;
						//var xpos = 350 - point.x;
						//var ypos = 300 - point.y;
						//moveOrigin(xpos,ypos);
						//$('#container').css('-webkit-transform-origin',xpos+"px" + " " + ypos+"px"); 
						break;
					case 270:
					/*
						var x = position.left;
						var y = position.top;
						point.x = y;
						point.y = x;
						$('#debug').html(point.x);
						*/
						point.x = position.left;
						point.y = position.top;
						$('#debug').html(point.x);
						break;
				}
				
				
				//$('#container').css('-moz-transform-origin',xRatio+"%" + " " + yRatio + "%");
				//$('#container').css('transform-origin',xRatio+"%" + " " + yRatio + "%");
			}
			
			function rotateSprite(){
				
			}
			

			
			function getRotationDegrees(obj) {
 			   var matrix = obj.css("-webkit-transform") ||
			    obj.css("-moz-transform")    ||
			    obj.css("-ms-transform")     ||
			    obj.css("-o-transform")      ||
			    obj.css("transform");
			    if(matrix !== 'none') {
			        var values = matrix.split('(')[1].split(')')[0].split(',');
			        var a = values[0];
			        var b = values[1];
			        var angle = Math.round(Math.atan2(b, a) * (180/Math.PI));
			    } else { var angle = 0; }
			    return angle;
			    //return (angle < 0) ? angle + 360 : angle;
			}
			
			
			
			
		
		</script>
	
	</body>

</html>