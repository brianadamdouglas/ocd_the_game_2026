var Timer_Controller=Tile_Controller.extend({construct:function(){this.SC.construct();this._timerInterval;this._endTime;this._totalTime;this._timeObj;this._pausedRemainingTime;this._className="Timer";},bindView:function(view,data){this.init(data);this._view=view;this._view.init(this,data);},init:function(data){this._rect={top:0,right:0,bottom:0,left:0};this.addListners();this._totalTime=data.duration;},addListners:function(){g_eventHandler.addAListener("pauseClock",this);g_eventHandler.addAListener("resumeClock",this);g_eventHandler.addAListener("startClock",this);g_eventHandler.addAListener("kill",this);},getTimeRemaining:function(endtime){var t=Date.parse(endtime)-Date.parse(new Date());var seconds=Math.floor((t/1000)%60);var minutes=Math.floor((t/1000/60)%60);var hours=Math.floor((t/(1000*60*60))%24);var days=Math.floor(t/(1000*60*60*24));return({total:t,days:days,hours:hours,minutes:minutes,seconds:seconds});},getEndTime:function(){var timeInMinutes=this._totalTime;var currentTime=Date.parse(new Date());var deadline=new Date(currentTime+timeInMinutes*60*1000);return(deadline);},updateClock:function(){this._timeObj=this.getTimeRemaining(this._endTime);var minutes="0"+this._timeObj.minutes;var seconds=this._timeObj.seconds;if(seconds<10){seconds="0"+seconds;}
if(minutes=="00"&&seconds=="00"){clearInterval(this._timerInterval);g_eventHandler.dispatchAnEvent("gameOver",{})}
this.getView().updateDisplay(minutes+":"+seconds);},startClock:function(){this._endTime=this.getEndTime();this._timerInterval=setInterval(this.updateClock.bind(this),1000);},pauseClock:function(){clearInterval(this._timerInterval);this._pausedRemainingTime=this.getTimeRemaining(this._endTime);},resumeClock:function(){var remainingMinutes=this._pausedRemainingTime.minutes;var remainingSeconds=(this._pausedRemainingTime.seconds/60);var remainingTime=remainingMinutes+remainingSeconds;this._totalTime=remainingTime;this._endTime=this.getEndTime();this._timerInterval=setInterval(this.updateClock.bind(this),1000);},setTotalTime:function(minutes){this._totalTime=minutes;},kill:function(){this.hide();}});