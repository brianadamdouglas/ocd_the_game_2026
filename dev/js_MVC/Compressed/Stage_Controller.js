var Stage_Controller=Tile_Controller.extend({construct:function(){this.SC.construct();this._className="Stage";},addTile:function(data){var className=data.className;if(className.match(/OnOffTileController/gi)!=null){var newController=new OnOffTileControl_Controller();var newView=new Tile_View();newController.bindView(newView,data);newController.setListenerString(data.listenerString);var re=new RegExp(data.listener,"gi");var spriteArray=this._mainController.getStageSpriteArray();for(var i=0;i<spriteArray.length;i++){if(spriteArray[i]._name.match(re)!=null){break;}}
newController.setListenerString(data.listenerString);newController.setThoughtType(data.thoughtType);newController.setObjectType(data.objectType);}else if(className.match(/OnOffTile/gi)!=null){var newController=new OnOffTile_Controller();var newView=new Tile_View();newController.bindView(newView,data);newController.setThoughtType(data.thoughtType);newController.setObjectType(data.objectType);}else if(className.match(/sticky/gi)!=null){var newController=new StickyTile_Controller();var newView=new Tile_View();newController.bindView(newView,data);newController.setMainController(this._mainController);newController.setHoldingOffset(data.stickyHoldingOffset);newController.setListenerString(data.listenerString);newController.setThoughtType(data.thoughtType);newController.setObjectType(data.objectType);}else if(className.match(/movable/gi)!=null){var newController=new MovableTile_Controller();var newView=new Tile_View();newController.bindView(newView,data);newController.setMoveObject(data.moveObject);newController.setThoughtType(data.thoughtType);newController.setObjectType(data.objectType);}else if(className.match(/door/gi)!=null){var newController=new Door_Controller();var newView=new Tile_View();newController.bindView(newView,data);newController.setListenerString(data.listenerString);newController.setVisibility(data.visibility);newController.setDefaultVisibility(data.visibility);newController.setThoughtType(data.thoughtType);newController.setObjectType(data.objectType);}else if(className.match(/hingedActive/gi)!=null){var newController=new HingedDoor_Controller();var newView=new Tile_View();newController.bindView(newView,data);newController.setListenerString1(data.listenerString1);newController.setListenerString2(data.listenerString2);newController.setVisibility(data.visibility);newController.setDefaultVisibility(data.visibility);}else if(className.match(/hingedInactive/gi)!=null){var newController=new HingedDoorInactive_Controller();var newView=new Tile_View();newController.bindView(newView,data);newController.setVisibility(data.visibility);newController.setDefaultVisibility(data.visibility);}else if(className.match(/obstacle/gi)!=null){var newController=new InteractiveTile_Controller();var newView=new Tile_View();newController.bindView(newView,data);newController.setThoughtType(data.thoughtType);newController.setObjectType(data.objectType);}else if(className.match(/mobileControl/gi)!=null){var newController=new Tile_Controller();var newView=new Mobile_View();newController.bindView(newView,data);}else if(className.match(/targetRevealed/gi)!=null){var newController=new DropTargetRevealed_Controller();var newView=new IDOverride_View();newController.bindView(newView,data);}else if(className.match(/dropTarget/gi)!=null){var newController=new DropTarget_Controller();var newView=new NonGraphic_View();newController.bindView(newView,data);newController.setMainController(this._mainController);newController.setDropTargetReaction(data.dropTargetFunction);}else{var newController=new Tile_Controller();var newView=new Tile_View();newController.bindView(newView,data);}
newController.createQuadRegistry();return(newController);},movementProgress:function(){g_eventHandler.dispatchAnEvent("movementProgress",{});},movementComplete:function(){g_eventHandler.dispatchAnEvent("checkForHit",{});},movementPossible:function(bool){g_eventHandler.dispatchAnEvent("setCanMoveForward",{bool:bool});},moveStage:function(distance,stageRotation,canMoveForward){var options={duration:50,easing:'swing',progress:this.movementProgress,complete:this.movementComplete};var myViewDiv=this._view.getDiv();if(canMoveForward){switch(stageRotation){case 0:myViewDiv.animate({left:"+=0",top:"+="+distance},options);break;case 90:myViewDiv.animate({left:"+="+distance,top:"+=0"},options);break;case 180:myViewDiv.animate({left:"+=0",top:"-="+distance},options);break;case 270:myViewDiv.animate({left:"-="+distance,top:"+=0"},options);break;}}},moveStageSansCallback:function(horizontal,vertical){var myViewDiv=this._view.getDiv();myViewDiv.animate({left:"+="+horizontal,top:"+="+vertical},.5,"easeInOutCirc");},repositionStage:function(targetRect,playerRect,stageRotation,previousMoves){var maximumOverlay=15;var padding=5;switch(stageRotation){case 0:if(targetRect.bottom>=playerRect.top&&playerRect.bottom>targetRect.bottom&&targetRect.bottom-playerRect.top<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,1);if(canMove){var distance=(playerRect.top-(targetRect.bottom+padding));this.moveStageSansCallback(0,distance);}
return 1;}else if(targetRect.top<=playerRect.bottom&&playerRect.top<targetRect.top&&playerRect.bottom-targetRect.top<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,2);if(canMove){var distance=((playerRect.bottom+(padding*3))-targetRect.top);this.moveStageSansCallback(0,distance);this.movementPossible(true);}
return 2;}else if(targetRect.right>=playerRect.left&&playerRect.right>targetRect.right&&targetRect.right-playerRect.left<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,3);if(canMove){var distance=(playerRect.left-(targetRect.right+(padding*3)));this.moveStageSansCallback(distance,0);this.movementPossible(true);}
return 3;}else if(targetRect.left<=playerRect.right&&playerRect.left<targetRect.left&&playerRect.right-targetRect.left<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,4);if(canMove){var distance=((playerRect.right+(padding*3))-targetRect.left);this.moveStageSansCallback(distance,0);this.movementPossible(true);}
return 4;}else{}
break;case 90:if(targetRect.right>=playerRect.left&&playerRect.right>targetRect.right&&targetRect.right-playerRect.left<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,1);if(canMove){var distance=(playerRect.left-(targetRect.right+padding));this.moveStageSansCallback(distance,0);}
return 1;}else if(targetRect.left<=playerRect.right&&playerRect.left<targetRect.left&&playerRect.right-targetRect.left<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,2);if(canMove){var distance=((playerRect.right+(padding*3))-targetRect.left);this.moveStageSansCallback(distance,0);this.movementPossible(true);}
return 2;}else if(targetRect.bottom>=playerRect.top&&playerRect.bottom>targetRect.bottom&&targetRect.bottom-playerRect.top<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,3);if(canMove){var distance=(playerRect.top-(targetRect.bottom+(padding*3)));this.moveStageSansCallback(0,distance);this.movementPossible(true);}
return 3;}else if(targetRect.top<=playerRect.bottom&&playerRect.top<targetRect.top&&playerRect.bottom-targetRect.top<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,4);if(canMove){var distance=((playerRect.bottom+(padding*3))-targetRect.top);this.moveStageSansCallback(0,distance);this.movementPossible(true);}
return 4;}else{}
break;case 180:if(targetRect.bottom>=playerRect.top&&playerRect.top>targetRect.top&&targetRect.bottom-playerRect.top<=maximumOverlay){console.log('a');var canMove=this.checkPreviousMoves(previousMoves,1);if(canMove){var distance=(playerRect.top-(targetRect.bottom+(padding*3)));this.moveStageSansCallback(0,distance);this.movementPossible(true);}
return 1;}else if(targetRect.top<=playerRect.bottom&&playerRect.top<targetRect.top&&playerRect.bottom-targetRect.top<=maximumOverlay){console.log('b');var canMove=this.checkPreviousMoves(previousMoves,2);if(canMove){var distance=((playerRect.bottom+padding)-targetRect.top);this.moveStageSansCallback(0,distance);}
return 2;}else if(targetRect.left<=playerRect.right&&playerRect.left<targetRect.left&&playerRect.right-targetRect.left<=maximumOverlay){console.log('c');var canMove=this.checkPreviousMoves(previousMoves,3);if(canMove){var distance=((playerRect.right+(padding*3))-targetRect.left);this.moveStageSansCallback(distance,0);this.movementPossible(true);}
return 3;}else if(targetRect.right>=playerRect.left&&playerRect.right>targetRect.left&&targetRect.right-playerRect.left<=maximumOverlay){console.log('d');var canMove=this.checkPreviousMoves(previousMoves,4);if(canMove){var distance=(playerRect.left-(targetRect.right+(padding*3)));this.moveStageSansCallback(distance,0);this.movementPossible(true);}
return 4;}else{}
break;case 270:if(targetRect.left<=playerRect.right&&playerRect.left<targetRect.left&&playerRect.right-targetRect.left<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,1);if(canMove){var distance=((playerRect.right+padding)-targetRect.left);this.moveStageSansCallback(distance,0);}
return 1;}else if(targetRect.right>=playerRect.left&&playerRect.right>targetRect.right&&targetRect.right-playerRect.left<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,2);if(canMove){var distance=(playerRect.left-(targetRect.right+(padding*3)));this.moveStageSansCallback(distance,0);this.movementPossible(true);}
return 2;}else if(targetRect.top<=playerRect.bottom&&playerRect.top<targetRect.top&&playerRect.bottom-targetRect.top<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,3);if(canMove){var distance=((playerRect.bottom+(padding*3))-targetRect.top);this.moveStageSansCallback(0,distance);this.movementPossible(true);}
return 3;}else if(targetRect.bottom>=playerRect.top&&playerRect.bottom>targetRect.bottom&&targetRect.bottom-playerRect.top<=maximumOverlay){var canMove=this.checkPreviousMoves(previousMoves,4);if(canMove){var distance=(playerRect.top-(targetRect.bottom+(padding*3)));this.moveStageSansCallback(0,distance);this.movementPossible(true);}
return 4;}else{}
break;default:console.log("defult");}},checkPreviousMoves:function(previousMoves,currentMove){for(var i=0;i<previousMoves.length;i++){if(previousMoves[i]==currentMove){return false;}}
return true;}});